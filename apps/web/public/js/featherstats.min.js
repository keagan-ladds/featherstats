"use strict";(()=>{var h="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var u=(i=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(i|=0));for(;i--;)e+=h[t[i]&63];return e};var m={batchSize:10,flushInterval:5e3,baseUrl:"http://localhost:3000",requeueOnFailure:!1},n=class{eventQueue=[];config;apiKey;userId;utmParameters;flushTimeout;isDestroyed=!1;lastPageHit=Date.now();constructor(e,t){this.apiKey=e,this.userId=this.getUserId(),this.config={...m,...t},this.utmParameters=this.getUtmParameters(),this.startFlushInterval(),this.registerEventHandlers()}async track(e,t={}){if(this.isDestroyed){console.warn("Attempting to track event on destroyed telemetry service");return}e==="page_hit"&&(this.lastPageHit=Date.now());let r=this.getDefaultPayload(e),s={eventType:e,sessionId:this.getSessionId(),userId:this.userId,timestamp:new Date().toISOString(),payload:{...r,...t.payload||{}}};this.eventQueue.push(s),this.eventQueue.length>=this.config.batchSize&&await this.flush()}async flush(){if(this.eventQueue.length===0||this.isDestroyed)return;let e=[...this.eventQueue];this.eventQueue=[];try{await this.sendEvents(e)}catch(t){console.error("Failed to send telemetry events:",t),!this.isDestroyed&&this.config.requeueOnFailure&&(this.eventQueue=[...e,...this.eventQueue])}}cleanup(){this.isDestroyed=!0,this.flush().catch(e=>{console.error("Error in cleanup flush:",e)}),this.flushTimeout&&(clearInterval(this.flushTimeout),this.flushTimeout=void 0)}registerEventHandlers(){var e=this;window.addEventListener("beforeunload",function(t){e.track("page_leave"),e.flush()}),document.addEventListener("visibilitychange",function(){document.visibilityState==="visible"?e.track("page_hit"):document.visibilityState==="hidden"&&(e.track("page_leave"),e.flush())})}getUtmParameters(){let e=new URLSearchParams(window.location.search);return{utm_source:e.get("utm_source")||void 0,utm_medium:e.get("utm_medium")||void 0,utm_campaign:e.get("utm_campaign")||void 0,utm_term:e.get("utm_term")||void 0,utm_content:e.get("utm_content")||void 0}}async sendEvents(e){await fetch(`${this.config.baseUrl}/api/v1/collect`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:JSON.stringify({events:e})})}getDefaultPayload(e){let t={duration:Date.now()-this.lastPageHit};return{referrer:document.referrer,pathname:window.location.pathname,utm_source:this.utmParameters.utm_source,utm_medium:this.utmParameters.utm_medium,utm_campaign:this.utmParameters.utm_campaign,utm_term:this.utmParameters.utm_term,utm_content:this.utmParameters.utm_content,...e==="page_leave"&&t||{}}}startFlushInterval(){this.flushTimeout&&clearInterval(this.flushTimeout),this.flushTimeout=setInterval(()=>{this.isDestroyed||this.flush().catch(e=>{console.error("Error in flush interval:",e)})},this.config.flushInterval),this.flushTimeout.unref&&this.flushTimeout.unref()}getSessionId(e=30){let t=Date.now(),r=sessionStorage.getItem("sessionId"),s=sessionStorage.getItem("sessionIdExpiry");return r&&s&&t<parseInt(s)||(r=u(),s=(t+e*60*1e3).toString(),sessionStorage.setItem("sessionId",r),sessionStorage.setItem("sessionIdExpiry",s)),r}getUserId(){let e=localStorage.getItem("userId");return e||(e=u(),localStorage.setItem("userId",e),e)}};function d(){let i=document.getElementsByTagName("script"),e=i[i.length-1],t=window.FEATHERSTATS_API_KEY||e.getAttribute("data-api-key");if(!t){console.error("Featherstats: No API key provided");return}let r=new n(t,{baseUrl:"http://localhost:3000"});r.track("page_hit");let s=window;s.featherstats=s.featherstats||{};let c=s.featherstats.q||[];s.featherstats={track:(a,o)=>r.track(a,{payload:o}),instance:r},c.forEach(([a,...o])=>{let l=s.featherstats[a];typeof l=="function"&&l.apply(null,o)})}d();})();
