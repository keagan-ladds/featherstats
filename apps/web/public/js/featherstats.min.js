"use strict";(()=>{var c="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var l=(r=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)t+=c[e[r]&63];return t};var h={batchSize:10,flushInterval:5e3,baseUrl:"http://localhost:3000",requeueOnFailure:!1},u=class{eventQueue=[];config;apiKey;userId;utmParameters;flushTimeout;isDestroyed=!1;lastPageHit=Date.now();constructor(t,e){this.apiKey=t,this.userId=this.getUserId(),this.config={...h,...e},this.utmParameters=this.getUtmParameters(),this.startFlushInterval(),this.registerEventHandlers()}async track(t,e,s={}){if(this.isDestroyed){console.warn("Attempting to track event on destroyed telemetry service");return}if(t==="custom_event"&&!e){console.warn("Attempting to track custom event without event name.");return}t==="page_hit"&&(this.lastPageHit=Date.now());let n=this.getDefaultPayload(t),i={eventType:t,sessionId:this.getSessionId(),userId:this.userId,timestamp:new Date().toISOString(),payload:{...n,eventName:e,properties:s.properties,revenue:s.revenue}};this.eventQueue.push(i),this.eventQueue.length>=this.config.batchSize&&await this.flush()}async flush(){if(this.eventQueue.length===0||this.isDestroyed)return;let t=[...this.eventQueue];this.eventQueue=[];try{await this.sendEvents(t)}catch(e){console.error("Failed to send telemetry events:",e),!this.isDestroyed&&this.config.requeueOnFailure&&(this.eventQueue=[...t,...this.eventQueue])}}cleanup(){this.isDestroyed=!0,this.flush().catch(t=>{console.error("Error in cleanup flush:",t)}),this.flushTimeout&&(clearInterval(this.flushTimeout),this.flushTimeout=void 0)}registerEventHandlers(){var t=this;function e(){t.track("page_hit")}function s(){t.track("page_leave"),t.flush()}window.addEventListener("beforeunload",function(i){s()}),document.addEventListener("visibilitychange",function(){document.visibilityState==="visible"?e():document.visibilityState==="hidden"&&s()}),window.addEventListener("popstate",function(){s(),setTimeout(e,0)});function n(i){let a=history[i];history[i]=function(...o){return s(),setTimeout(e,0),a.apply(this,o)}}n("pushState"),n("replaceState")}getUtmParameters(){let t=new URLSearchParams(window.location.search);return{utm_source:t.get("utm_source")||void 0,utm_medium:t.get("utm_medium")||void 0,utm_campaign:t.get("utm_campaign")||void 0,utm_term:t.get("utm_term")||void 0,utm_content:t.get("utm_content")||void 0}}async sendEvents(t){await fetch(`${this.config.baseUrl}/api/v1/collect`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:JSON.stringify({events:t})})}getDefaultPayload(t){let e={duration:Date.now()-this.lastPageHit};return{referrer:document.referrer,pathname:window.location.pathname,utm_source:this.utmParameters.utm_source,utm_medium:this.utmParameters.utm_medium,utm_campaign:this.utmParameters.utm_campaign,utm_term:this.utmParameters.utm_term,utm_content:this.utmParameters.utm_content,...t==="page_leave"&&e||{}}}startFlushInterval(){this.flushTimeout&&clearInterval(this.flushTimeout),this.flushTimeout=setInterval(()=>{this.isDestroyed||this.flush().catch(t=>{console.error("Error in flush interval:",t)})},this.config.flushInterval),this.flushTimeout.unref&&this.flushTimeout.unref()}getSessionId(t=30){let e=Date.now(),s=sessionStorage.getItem("sessionId"),n=sessionStorage.getItem("sessionIdExpiry");return s&&n&&e<parseInt(n)||(s=l(),n=(e+t*60*1e3).toString(),sessionStorage.setItem("sessionId",s),sessionStorage.setItem("sessionIdExpiry",n)),s}getUserId(){let t=localStorage.getItem("userId");return t||(t=l(),localStorage.setItem("userId",t),t)}};function m(){let r=document.getElementsByTagName("script"),t=window.FEATHERSTATS_API_KEY;if(!t){console.error("Featherstats: No API key provided");return}let e=new u(t,{baseUrl:"http://localhost:3000"});e.track("page_hit");let s=window;s.featherstats=s.featherstats||{};let n=s.featherstats.q||[];s.featherstats={track:(i,a)=>e.track("custom_event",i,a),instance:e},n.forEach(([i,...a])=>{let o=s.featherstats[i];typeof o=="function"&&o.apply(null,a)})}m();})();
