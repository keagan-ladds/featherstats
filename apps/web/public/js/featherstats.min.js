"use strict";(()=>{var h="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var u=(s=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(s|=0));for(;s--;)e+=h[t[s]&63];return e};var f={batchSize:10,flushInterval:5e3,baseUrl:"https://featherstats.com"},i=class{eventQueue=[];config;apiKey;sessionId;flushTimeout;isDestroyed=!1;constructor(e,t){this.apiKey=e,this.sessionId=this.getSessionId(),this.config={...f,...t},this.startFlushInterval()}getSessionId(){let e=sessionStorage.getItem("sessionId");return e||(e=u(),sessionStorage.setItem("sessionId",e),e)}startFlushInterval(){this.flushTimeout&&clearInterval(this.flushTimeout),this.flushTimeout=setInterval(()=>{this.isDestroyed||this.flush().catch(e=>{console.error("Error in flush interval:",e)})},this.config.flushInterval),this.flushTimeout.unref&&this.flushTimeout.unref()}async track(e,t={}){if(this.isDestroyed){console.warn("Attempting to track event on destroyed telemetry service");return}let r={eventType:e,sessionId:this.sessionId,timestamp:new Date().toISOString(),payload:t.payload||{}};this.eventQueue.push(r),this.eventQueue.length>=this.config.batchSize&&await this.flush()}async flush(){if(this.eventQueue.length===0||this.isDestroyed)return;let e=[...this.eventQueue];this.eventQueue=[];try{await this.sendEvents(e)}catch(t){console.error("Failed to send telemetry events:",t),this.isDestroyed||(this.eventQueue=[...e,...this.eventQueue])}}async sendEvents(e){await fetch(`${this.config.baseUrl}/api/v1/event`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:JSON.stringify({events:e})})}cleanup(){this.isDestroyed=!0,this.flush().catch(e=>{console.error("Error in cleanup flush:",e)}),this.flushTimeout&&(clearInterval(this.flushTimeout),this.flushTimeout=void 0)}};function d(){let s=document.getElementsByTagName("script"),e=s[s.length-1],t=window.FEATHERSTATS_API_KEY||e.getAttribute("data-api-key");if(!t){console.error("Featherstats: No API key provided");return}let r=new i(t,{baseUrl:"http://localhost:3000"});r.track("page_hit",{payload:{referrer:document.referrer}});let n=window;n.featherstats=n.featherstats||{};let c=n.featherstats.q||[];n.featherstats={track:(o,a)=>r.track(o,{payload:a}),instance:r},c.forEach(([o,...a])=>{let l=n.featherstats[o];typeof l=="function"&&l.apply(null,a)})}d();})();
