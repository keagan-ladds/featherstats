"use strict";(()=>{var d="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var h=(t=21)=>{let e="",s=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)e+=d[s[t]&63];return e};var p={batchSize:10,flushInterval:5e3,baseUrl:"http://localhost:3000",requeueOnFailure:!1},l=class{eventQueue=[];config;apiKey;userId;flushTimeout;isDestroyed=!1;constructor(e,s){this.apiKey=e,this.userId=this.getUserId(),this.config={...p,...s},this.startFlushInterval()}getSessionId(e=30){let s=Date.now(),n=sessionStorage.getItem("sessionId"),i=sessionStorage.getItem("sessionIdExpiry");return n&&i&&s<parseInt(i)||(n=h(),i=(s+e*60*1e3).toString(),sessionStorage.setItem("sessionId",n),sessionStorage.setItem("sessionIdExpiry",i)),n}getUserId(){let e=localStorage.getItem("userId");return e||(e=h(),localStorage.setItem("userId",e),e)}startFlushInterval(){this.flushTimeout&&clearInterval(this.flushTimeout),this.flushTimeout=setInterval(()=>{this.isDestroyed||this.flush().catch(e=>{console.error("Error in flush interval:",e)})},this.config.flushInterval),this.flushTimeout.unref&&this.flushTimeout.unref()}async track(e,s={}){if(this.isDestroyed){console.warn("Attempting to track event on destroyed telemetry service");return}let n={eventType:e,sessionId:this.getSessionId(),userId:this.userId,timestamp:new Date().toISOString(),payload:s.payload||{}};this.eventQueue.push(n),this.eventQueue.length>=this.config.batchSize&&await this.flush()}async flush(){if(this.eventQueue.length===0||this.isDestroyed)return;let e=[...this.eventQueue];this.eventQueue=[];try{await this.sendEvents(e)}catch(s){console.error("Failed to send telemetry events:",s),!this.isDestroyed&&this.config.requeueOnFailure&&(this.eventQueue=[...e,...this.eventQueue])}}async sendEvents(e){await fetch(`${this.config.baseUrl}/api/v1/collect`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey},body:JSON.stringify({events:e})})}cleanup(){this.isDestroyed=!0,this.flush().catch(e=>{console.error("Error in cleanup flush:",e)}),this.flushTimeout&&(clearInterval(this.flushTimeout),this.flushTimeout=void 0)}};function g(){let t=document.getElementsByTagName("script"),e=t[t.length-1],s=window.FEATHERSTATS_API_KEY||e.getAttribute("data-api-key");if(!s){console.error("Featherstats: No API key provided");return}let n=y(),i={referrer:document.referrer,pathname:window.location.pathname,utm_source:n.utm_source,utm_medium:n.utm_medium,utm_campaign:n.utm_campaign,utm_term:n.utm_term,utm_content:n.utm_content},r=new l(s,{baseUrl:"https://app.featherstats.com"});r.track("page_hit",{payload:i});let a=window;a.featherstats=a.featherstats||{};let f=a.featherstats.q||[];a.featherstats={track:(u,c)=>r.track(u,{payload:c}),instance:r},f.forEach(([u,...c])=>{let m=a.featherstats[u];typeof m=="function"&&m.apply(null,c)});let o=location.pathname;window.addEventListener("click",function(){location.pathname!=o&&(o=location.pathname,r.track("page_hit",{payload:{...i,pathname:o}}))}),window.addEventListener("beforeunload",function(u){r.track("page_leave",{payload:{...i,pathname:o}}),r.cleanup()}),document.addEventListener("visibilitychange",function(){document.visibilityState==="hidden"&&(r.track("page_leave",{payload:{...i,pathname:o}}),r.cleanup())})}g();function y(){let t=new URLSearchParams(window.location.search);return{utm_source:t.get("utm_source")||void 0,utm_medium:t.get("utm_medium")||void 0,utm_campaign:t.get("utm_campaign")||void 0,utm_term:t.get("utm_term")||void 0,utm_content:t.get("utm_content")||void 0}}})();
